{% extends 'core/base.html' %}
{% load static %}

{% block title %}Resources Hub{% endblock %}

{% block content %}
<section class="relative bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');">
  <div class="bg-black bg-opacity-50">
    <div class="container mx-auto px-4 py-24 text-center text-white">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">ESA-KU Learning Resources Hub</h1>
      <p class="max-w-2xl mx-auto mb-6 text-lg">
        Access valuable educational materials, study guides, and learning resources from the ESA-KU community
      </p>
      
      <!-- Search Box -->
      <div class="max-w-xl mx-auto mt-8">
        <form action="{% url 'resources' %}" method="GET" class="relative mb-8">
          <input type="hidden" name="category" value="{{ category }}">
          <input type="hidden" name="sort" value="{{ sort }}">
          <input type="text" name="search" value="{{ search }}" placeholder="Search resources..." 
                 class="w-full px-4 py-3 rounded-[25px] border-0 text-black pl-10">
              <button type="submit" class="bg-blue-800 hover:bg-blue-900 absolute right-0 top-0 h-full text-white px-4 rounded-r-lg rounded-l-none transition">
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<div class="container max-w-6xl mx-auto px-4 py-12">
  {% if messages %}
    <div class="mb-8">
      {% for message in messages %}
        <div class="p-4 {% if message.tags == 'success' %}bg-green-100 text-green-700 border-green-400{% elif message.tags == 'error' %}bg-red-100 text-red-700 border-red-400{% else %}bg-blue-100 text-blue-700 border-blue-400{% endif %} rounded border-l-4">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  {% if is_admin and pending_resources_count > 0 %}
    <div class="mb-8 p-4 bg-yellow-100 text-yellow-800 border-yellow-400 rounded border-l-4 flex justify-between items-center">
      <div>
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <span>There {{ pending_resources_count|pluralize:"is,are" }} <strong>{{ pending_resources_count }}</strong> pending resource{{ pending_resources_count|pluralize }} that need{{ pending_resources_count|pluralize:"s," }} your approval.</span>
      </div>
      <a href="/admin/core/resource/?is_approved__exact=0" class="bg-yellow-700 hover:bg-yellow-800 text-white px-3 py-1 rounded text-sm">
        Review Now
      </a>
    </div>
  {% endif %}
  
  <!-- Filters Bar -->
  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <div class="flex flex-wrap justify-between">
      <!-- Category Filters -->
      <div class="flex flex-wrap gap-2 mb-4 md:mb-0 overflow-x-auto pb-2">
        <a href="{% url 'resources' %}{% if search %}?search={{ search }}{% endif %}{% if sort and sort != 'latest' %}&sort={{ sort }}{% endif %}" 
          class="px-4 py-2 rounded-full {% if not category %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium whitespace-nowrap">
          All Resources
        </a>
        <a href="{% url 'resources' %}?category=document{% if search %}&search={{ search }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
          class="px-4 py-2 rounded-full flex items-center {% if category == 'document' %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium whitespace-nowrap">
          <i class="fas fa-file-pdf mr-2"></i> Documents <span class="ml-1 text-xs">({{ document_count }})</span>
        </a>
        <a href="{% url 'resources' %}?category=video{% if search %}&search={{ search }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
          class="px-4 py-2 rounded-full flex items-center {% if category == 'video' %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium whitespace-nowrap">
          <i class="fas fa-video mr-2"></i> Videos <span class="ml-1 text-xs">({{ video_count }})</span>
        </a>
        <a href="{% url 'resources' %}?category=link{% if search %}&search={{ search }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
          class="px-4 py-2 rounded-full flex items-center {% if category == 'link' %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium whitespace-nowrap">
          <i class="fas fa-link mr-2"></i> Links <span class="ml-1 text-xs">({{ link_count }})</span>
        </a>
      </div>
      
      <!-- Sort Filters -->
      <div class="flex space-x-2">
        <a href="{% url 'resources' %}{% if category %}?category={{ category }}{% endif %}{% if search %}&search={{ search }}{% endif %}" 
          class="px-4 py-2 rounded-full {% if not sort or sort == 'latest' %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium">
          Latest
        </a>
        <a href="{% url 'resources' %}?sort=popular{% if category %}&category={{ category }}{% endif %}{% if search %}&search={{ search }}{% endif %}" 
          class="px-4 py-2 rounded-full {% if sort == 'popular' %}bg-blue-900 text-white{% else %}bg-gray-100 text-gray-800 hover:border-blue-900{% endif %} transition border-2 border-transparent font-medium">
          Most Downloaded
        </a>
      </div>
    </div>
  </div>
  
  <div class="flex flex-col md:flex-row gap-8">
    <!-- Main Content -->
    <div class="w-full md:w-2/3">
      {% if search %}
        <div class="mb-6">
          <h2 class="text-xl font-semibold text-gray-800">
            Search results for: "{{ search }}"
          </h2>
          <p class="text-gray-600">{{ resources|length }} results found</p>
        </div>
      {% endif %}
      
      {% if resources %}
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          {% for resource in resources %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition transform hover:-translate-y-1">
              <div class="p-5">
                <div class="flex items-center mb-3">
                  <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                    {% if resource.category == 'document' %}
                      <i class="fas fa-file-pdf text-2xl text-blue-900"></i>
                    {% elif resource.category == 'video' %}
                      <i class="fas fa-video text-2xl text-blue-900"></i>
                    {% elif resource.category == 'link' %}
                      <i class="fas fa-link text-2xl text-blue-900"></i>
                    {% else %}
                      <i class="fas fa-file text-2xl text-blue-900"></i>
                    {% endif %}
                  </div>
                  <div>
                    <span class="text-xs bg-orange-500 text-white px-3 py-1 rounded-full">{{ resource.get_category_display }}</span>
                    <h3 class="font-semibold text-blue-900 mt-1">
                      <a href="{% url 'resource_detail' resource_id=resource.id %}" class="hover:underline">
                        {{ resource.title }}
                      </a>
                    </h3>
                  </div>
                </div>
                
                <p class="text-sm text-gray-600 mb-4 line-clamp-2">
                  {{ resource.description|truncatechars:150 }}
                </p>
                
                <div class="flex justify-between items-center text-xs text-gray-500">
                  <div>
                    <span><i class="far fa-eye mr-1"></i> {{ resource.views }}</span>
                    <span class="ml-3"><i class="fas fa-download mr-1"></i> {{ resource.downloads }}</span>
                  </div>
                  <span>{{ resource.created_at|date:"M d, Y" }}</span>
                </div>
                
                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-end">
                  {% if resource.category == 'document' and resource.file %}
                    <a href="{% url 'resource_download' resource_id=resource.id %}" class="text-blue-900 hover:bg-blue-900 hover:text-white flex items-center text-sm font-medium px-3 py-1 rounded transition">
                      <i class="fas fa-download mr-1"></i> Download
                    </a>
                  {% elif resource.category == 'link' and resource.link %}
                    <a href="{{ resource.link }}" target="_blank" rel="noopener noreferrer" class="text-blue-900 hover:bg-blue-900 hover:text-white flex items-center text-sm font-medium px-3 py-1 rounded transition">
                      <i class="fas fa-external-link-alt mr-1"></i> Visit Link
                    </a>
                  {% elif resource.category == 'video' and resource.link %}
                    <a href="{{ resource.link }}" target="_blank" rel="noopener noreferrer" class="text-blue-900 hover:bg-blue-900 hover:text-white flex items-center text-sm font-medium px-3 py-1 rounded transition">
                      <i class="fas fa-play mr-1"></i> Watch Video
                    </a>
                  {% else %}
                    <a href="{% url 'resource_detail' resource_id=resource.id %}" class="text-blue-900 hover:bg-blue-900 hover:text-white flex items-center text-sm font-medium px-3 py-1 rounded transition">
                      <i class="fas fa-info-circle mr-1"></i> View Details
                    </a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        
        <!-- Pagination would go here -->
      {% else %}
        <div class="text-center py-12">
          <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-search text-3xl text-blue-900"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">No resources found</h3>
          <p class="text-gray-600 mb-6">
            {% if search %}
              No resources match your search criteria. Try using different keywords.
            {% else %}
              There are no resources available in this category yet.
            {% endif %}
          </p>
          <a href="{% url 'resource_create' %}" class="inline-block bg-green-700 hover:bg-green-800 text-white font-semibold py-2 px-6 rounded transition">
            Upload a Resource
          </a>
        </div>
      {% endif %}
    </div>
    
    <!-- Sidebar -->
    <div class="w-full md:w-1/3">
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h3 class="text-lg font-bold border-b-2 border-red-600 pb-2 text-gray-700 mb-4">Resource Categories</h3>
        <ul class="space-y-3">
          <li>
            <a href="{% url 'resources' %}" class="flex justify-between items-center text-gray-700 hover:text-blue-900 transition">
              <span class="flex items-center">
                <i class="fas fa-archive mr-2 text-gray-500"></i> All Resources
              </span>
              <span class="bg-gray-200 text-gray-700 rounded-full px-2 py-1 text-xs">
                {{ document_count|add:video_count|add:link_count }}
              </span>
            </a>
          </li>
          <li>
            <a href="{% url 'resources' %}?category=document" class="flex justify-between items-center text-gray-700 hover:text-blue-900 transition">
              <span class="flex items-center">
                <i class="fas fa-file-pdf mr-2 text-red-500"></i> Documents
              </span>
              <span class="bg-gray-200 text-gray-700 rounded-full px-2 py-1 text-xs">
                {{ document_count }}
              </span>
            </a>
          </li>
          <li>
            <a href="{% url 'resources' %}?category=video" class="flex justify-between items-center text-gray-700 hover:text-blue-900 transition">
              <span class="flex items-center">
                <i class="fas fa-video mr-2 text-blue-500"></i> Videos
              </span>
              <span class="bg-gray-200 text-gray-700 rounded-full px-2 py-1 text-xs">
                {{ video_count }}
              </span>
            </a>
          </li>
          <li>
            <a href="{% url 'resources' %}?category=link" class="flex justify-between items-center text-gray-700 hover:text-blue-900 transition">
              <span class="flex items-center">
                <i class="fas fa-link mr-2 text-green-500"></i> Links
              </span>
              <span class="bg-gray-200 text-gray-700 rounded-full px-2 py-1 text-xs">
                {{ link_count }}
              </span>
            </a>
          </li>
        </ul>
      </div>
      
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h3 class="text-lg font-bold border-b-2 border-red-600 pb-2 text-gray-700 mb-4">Upload Resource</h3>
        <p class="text-gray-600 mb-4">
          Share valuable materials with the ESA-KU community by uploading your resources. All members are welcome to contribute! Uploads will be reviewed by admins before appearing.
        </p>
        <a href="{% url 'resource_create' %}" class="block w-full bg-blue-900 hover:bg-blue-700 text-white text-center font-semibold py-2 px-4 rounded transition">
          Upload New Resource
        </a>
      </div>
      
      <!-- Professional Connections -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-bold border-b-2 border-blue-600 pb-2 text-gray-700 mb-4">Professional Connections</h3>
        <p class="text-gray-600 mb-4">
          Looking for professional organizations, engineering clubs, or community networks? Check out our Engineering Networks page.
        </p>
        <a href="{% url 'more_sites' %}" class="block w-full bg-blue-600 hover:bg-blue-500 text-white text-center font-semibold py-2 px-4 rounded transition">
          <i class="fas fa-users mr-2"></i> View Engineering Networks
        </a>
      </div>
      
      {% if popular_resources %}
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-lg font-bold border-b-2 border-red-600 pb-2 text-gray-700 mb-4">Most Downloaded</h3>
          <ul class="space-y-4">
            {% for resource in popular_resources %}
              <li>
                <a href="{% url 'resource_detail' resource_id=resource.id %}" class="flex items-start hover:bg-gray-50 p-2 rounded -mx-2 transition">
                  <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
                    {% if resource.category == 'document' %}
                      <i class="fas fa-file-pdf text-blue-900"></i>
                    {% elif resource.category == 'video' %}
                      <i class="fas fa-video text-blue-900"></i>
                    {% elif resource.category == 'link' %}
                      <i class="fas fa-link text-blue-900"></i>
                    {% else %}
                      <i class="fas fa-file text-blue-900"></i>
                    {% endif %}
                  </div>
                  <div>
                    <p class="text-sm font-medium text-gray-900 line-clamp-1">{{ resource.title }}</p>
                    <div class="flex items-center text-xs text-gray-500 mt-1">
                      <span><i class="fas fa-download mr-1"></i> {{ resource.downloads }}</span>
                      <span class="mx-2">â€¢</span>
                      <span>{{ resource.created_at|date:"M d, Y" }}</span>
                    </div>
                  </div>
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
