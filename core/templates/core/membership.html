{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Membership - ESA{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2071&q=80');">
  <div class="bg-black bg-opacity-50">
    <div class="container mx-auto px-4 py-24">
      <div class="flex flex-wrap md:flex-nowrap items-center">
        <div class="w-full md:w-1/2 mb-8 md:mb-0 text-white">
          <h1 class="text-4xl font-bold mb-4">Join the ESA-KU Community</h1>
          <p class="text-lg mb-4">Access exclusive resources, attend special events, and connect with fellow engineering students and professionals.</p>
          <p class="mb-4">
            {% if is_member %}
              <span class="bg-green-600 text-white px-3 py-1 rounded-full inline-flex items-center">
                <i class="fas fa-check-circle mr-2"></i>You're already a member!
              </span>
            {% else %}
              <span class="bg-yellow-500 text-white px-3 py-1 rounded-full inline-flex items-center">
                <i class="fas fa-info-circle mr-2"></i>Not a member yet
              </span>
            {% endif %}
          </p>
        </div>
        <!--
        <div class="w-full md:w-1/2">
          <img src="{% static 'images/membership_hero.png' %}" alt="ESA Membership" class="rounded-lg shadow-lg w-full">
        </div>
        -->
      </div>
    </div>
  </div>
</section>

<!-- Benefits Section -->
<section class="py-12 bg-gray-100">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-10">Membership Benefits</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-book-open text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Exclusive Resources</h3>
                <p class="text-gray-700 mb-4">
                    Access to engineering research papers, study materials, and technical resources.
                </p>
                <a href="{% url 'resources' %}" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>Browse resources</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-users text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Networking</h3>
                <p class="text-gray-700 mb-4">
                    Connect with engineering professionals, academics, and fellow students in the field.
                </p>
                <a href="{% url 'communities' %}" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>Join communities</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-calendar-check text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Priority Event Access</h3>
                <p class="text-gray-700 mb-4">
                    Early registration and discounts for workshops, field trips, and engineering conferences.
                </p>
                <a href="{% url 'events' %}" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>Upcoming events</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-graduation-cap text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Learning Opportunities</h3>
                <p class="text-gray-700 mb-4">
                    Access to engineering workshops, training sessions, and technical educational content.
                </p>
                <a href="{% url 'resources' %}?category=document" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>Educational materials</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-certificate text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Certifications</h3>
                <p class="text-gray-700 mb-4">
                    Official member certificate and recognition in the engineering community.
                </p>
                <a href="{% url 'profile' %}" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>View your profile</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
            <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition text-center">
                <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-store text-3xl text-blue-900"></i>
                </div>
                <h3 class="text-xl font-bold text-blue-900 mb-3">Store Discounts</h3>
                <p class="text-gray-700 mb-4">
                    Special discounts on ESA merchandise and engineering tools.
                </p>
                <a href="{% url 'store' %}" class="text-blue-700 hover:text-blue-900 inline-flex items-center font-medium">
                    <span>Shop now</span>
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Member Resources & Opportunities Section -->
<section class="py-12 bg-white" id="membershipOpportunities" >
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-blue-900 text-center mb-10">Membership Opportunities</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Members' Own Stories -->
      <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <i class="fas fa-quote-right text-2xl text-blue-900"></i>
          </div>
          <h3 class="text-xl font-bold text-blue-900">Members' Own Stories</h3>
        </div>
        <p class="text-gray-700 mb-4">
          Show members and non-members alike what it means to be part of ESA. Your story can inspire others to join our community and make the most of their engineering education.
        </p>
        <a href="{% url 'blog_post_create' %}" class="text-green-700 font-semibold hover:underline flex items-center">
          <span>Share your ESA story</span>
          <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
        
      <!-- Gift of Membership -->
      <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <i class="fas fa-gift text-2xl text-blue-900"></i>
          </div>
          <h3 class="text-xl font-bold text-blue-900">Gift of Membership</h3>
        </div>
        <p class="text-gray-700 mb-4">
          ESA membership is a great gift idea and a way to share in the experience of being a member of ESA. Support a friend's engineering journey with this meaningful present.
        </p>
        <a href="{% url 'member_get_member' %}" class="text-green-700 font-semibold hover:underline flex items-center">
          <span>Give the gift of membership</span>
          <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
      
      <!-- Member-Get-a-Member -->
      <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <i class="fas fa-user-plus text-2xl text-blue-900"></i>
          </div>
          <h3 class="text-xl font-bold text-blue-900">Member-Get-a-Member</h3>
        </div>
        <p class="text-gray-700 mb-4">
          Help grow our engineering community by sponsoring someone's membership. You can pay for a friend, colleague, or someone deserving to join ESA and enjoy all membership benefits.
        </p>
        <a href="{% url 'member_get_member' %}" class="text-green-700 font-semibold hover:underline flex items-center">
          <span>Pay for someone's membership</span>
          <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
      
      <!-- ESA Journals for Members -->
      <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <i class="fas fa-book-open text-2xl text-blue-900"></i>
          </div>
          <h3 class="text-xl font-bold text-blue-900 mb-3">ESA Journals for Members</h3>
    </div>
        <p class="text-gray-700 mb-4">
          More than 400 engineering students at Kenyatta University make ESA an integral part of their lives. Explore their innovations and experiences in our journals.
        </p>
        <a href="{% url 'esa_journals' %}" class="text-green-700 font-semibold hover:underline flex items-center">
          <span>View more videos and stories at ESA Journals</span>
          <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Pricing Plans Section -->
<section class="py-12" id="pricingSection">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-blue-900 text-center mb-2">Membership Plans</h2>
        <p class="text-xl text-center text-gray-600 mb-10">Choose the membership plan that best suits your needs</p>
        
        {% if is_member %}
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-10 text-center">
            <i class="fas fa-star mr-2"></i>
            <strong>You already have an active membership!</strong> Your membership is valid until your expiry date.
        </div>
        {% endif %}
        
        <div class="max-w-4xl mx-auto">
            <!-- Membership Tiers -->
            <div class="mb-12">
                <h2 class="text-3xl font-bold text-center mb-8">Choose Your Membership Tier</h2>
                
                <!-- Toggle Buttons -->
                <div class="flex justify-center space-x-4 mb-8">
                    <button id="studentToggle" class="px-6 py-2 rounded-lg bg-blue-900 text-white hover:bg-blue-800 transition-colors">
                        Student
                    </button>
                    <button id="graduateToggle" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors">
                        Graduate/Professional
                    </button>
                </div>

                <!-- Student Tiers -->
                <div id="studentTiers" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Year Tier -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-900">
                        <h3 class="text-xl font-bold text-blue-900 mb-4">First Year Student</h3>
                        <p class="text-3xl font-bold mb-4">KSh 250</p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Access to all ESA-KU events
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Student resources
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Networking opportunities
                            </li>
                        </ul>
                        <button onclick="selectTier('first_year', 250)" class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors">
                            Select Plan
                        </button>
                    </div>

                    <!-- Other Students Tier -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-900">
                        <h3 class="text-xl font-bold text-blue-900 mb-4">Other Students</h3>
                        <p class="text-3xl font-bold mb-4">KSh 300</p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                All First Year benefits
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Priority event registration
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Access to workshops
                            </li>
                        </ul>
                        <button onclick="selectTier('other_students', 300)" class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors">
                            Select Plan
                        </button>
                    </div>
                </div>

                <!-- Graduate/Professional Tiers -->
                <div id="graduateTiers" class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden">
                    <!-- Graduate Tier -->
                    <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-900">
                        <h3 class="text-xl font-bold text-blue-900 mb-4">Graduate/Professional</h3>
                        <p class="text-3xl font-bold mb-4">KSh 1,000</p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                All Student benefits
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Professional networking
                            </li>
                            <li class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Career development resources
                            </li>
                        </ul>
                        <button onclick="selectTier('graduate', 1000)" class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors">
                            Select Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section class="py-12 bg-gray-100">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-blue-900 text-center mb-10">Frequently Asked Questions</h2>
        <div class="max-w-3xl mx-auto space-y-6">
            <div class="bg-white rounded-lg shadow">
                <button class="flex justify-between items-center w-full p-6 text-left" onclick="toggleFAQ(this)">
                    <span class="font-bold text-blue-900">How do I know which membership plan is right for me?</span>
                    <i class="fas fa-chevron-down text-blue-900 transition-transform"></i>
                </button>
                <div class="hidden px-6 pb-6">
                    <p class="text-gray-700">
                        If you're a first-year student, the Basic plan is perfect to get started. Current students should choose the Standard plan for the best value, while graduates and professionals benefit most from the Premium plan with its advanced networking and collaboration opportunities.
                    </p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow">
                <button class="flex justify-between items-center w-full p-6 text-left" onclick="toggleFAQ(this)">
                    <span class="font-bold text-blue-900">How can I pay for membership?</span>
                    <i class="fas fa-chevron-down text-blue-900 transition-transform"></i>
                </button>
                <div class="hidden px-6 pb-6">
                    <p class="text-gray-700">
                        We accept M-Pesa for local payments and PayPal for international payments. Both methods are secure and transactions are processed immediately.
                    </p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow">
                <button class="flex justify-between items-center w-full p-6 text-left" onclick="toggleFAQ(this)">
                    <span class="font-bold text-blue-900">Can I upgrade my membership plan later?</span>
                    <i class="fas fa-chevron-down text-blue-900 transition-transform"></i>
                </button>
                <div class="hidden px-6 pb-6">
                    <p class="text-gray-700">
                        Yes! You can upgrade your membership at any time. The remaining value of your current membership will be credited toward your new plan.
                    </p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow">
                <button class="flex justify-between items-center w-full p-6 text-left" onclick="toggleFAQ(this)">
                    <span class="font-bold text-blue-900">How long does my membership last?</span>
                    <i class="fas fa-chevron-down text-blue-900 transition-transform"></i>
                </button>
                <div class="hidden px-6 pb-6">
                    <p class="text-gray-700">
                        Memberships are valid for the duration specified in your selected plan, typically 12 months. You'll receive renewal reminders before expiration.
                    </p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow">
                <button class="flex justify-between items-center w-full p-6 text-left" onclick="toggleFAQ(this)">
                    <span class="font-bold text-blue-900">What happens if I need to cancel my membership?</span>
                    <i class="fas fa-chevron-down text-blue-900 transition-transform"></i>
                </button>
                <div class="hidden px-6 pb-6">
                    <p class="text-gray-700">
                        While we don't offer refunds for membership fees, you can contact us at <a href="mailto:esa.kenyattauniv@gmail.com" class="text-blue-700 hover:underline">esa.kenyattauniv@gmail.com</a> if you have special circumstances.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials Section -->
<section class="py-12">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-blue-900 text-center mb-10">What Our Members Say</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="bg-white rounded-xl shadow p-6 relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2">
                    <div class="w-12 h-12 bg-blue-900 rounded-full flex items-center justify-center text-white font-bold text-xl">
                        SK
                    </div>
                </div>
                <div class="pt-8">
                    <div class="flex text-yellow-400 mb-3 justify-center">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <p class="italic text-gray-700 mb-4">
                        "Joining ESA was one of my best decisions at KU. I've made incredible connections and learned so much beyond the classroom."
                    </p>
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-blue-900">Sarah Kimani</h4>
                            <p class="text-sm text-gray-600">3rd Year Student</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6 relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2">
                    <div class="w-12 h-12 bg-blue-900 rounded-full flex items-center justify-center text-white font-bold text-xl">
                        DO
                    </div>
                </div>
                <div class="pt-8">
                    <div class="flex text-yellow-400 mb-3 justify-center">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <p class="italic text-gray-700 mb-4">
                        "As a graduate, ESA membership has opened doors to research opportunities and connected me with professionals in my field."
                    </p>
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-blue-900">David Omondi</h4>
                            <p class="text-sm text-gray-600">KU Graduate 2022</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6 relative">
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2">
                    <div class="w-12 h-12 bg-blue-900 rounded-full flex items-center justify-center text-white font-bold text-xl">
                        JM
                    </div>
                </div>
                <div class="pt-8">
                    <div class="flex text-yellow-400 mb-3 justify-center">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <p class="italic text-gray-700 mb-4">
                        "The resources available through ESA membership have been invaluable for my studies. The community is supportive and inspiring."
                    </p>
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-blue-900">Jane Mutua</h4>
                            <p class="text-sm text-gray-600">2nd Year Student</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-12 bg-blue-900 text-white">
    <div class="container mx-auto px-4 text-center">
        <h2 class="text-3xl font-bold mb-4">Ready to join the ESA-KU community?</h2>
        <p class="max-w-2xl mx-auto mb-8 text-lg">
            Become a member today and unlock all the benefits!
        </p>
        <div class="flex flex-wrap justify-center gap-4">
            {% if is_member %}
                <button class="bg-white text-blue-900 cursor-not-allowed opacity-75 px-8 py-3 rounded-lg font-bold" disabled>Already a Member</button>
            {% elif not user.is_authenticated %}
                <a href="{% url 'register_with_payment' %}" class="bg-white text-blue-900 hover:bg-gray-100 px-8 py-3 rounded-lg font-bold transition">
                    Join Now
                </a>
            {% else %}
                <a href="#pricingSection" class="bg-white text-blue-900 hover:bg-gray-100 px-8 py-3 rounded-lg font-bold transition">
                    Join Now
                </a>
            {% endif %}
        </div>
  </div>
</section>
<!-- Manual Payment Instructions Modal -->
<div id="paymentInstructionsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-gradient-to-r from-blue-900 to-blue-700 text-white p-6 rounded-t-2xl">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold">Complete Your Membership</h2>
                    <p class="text-blue-100 text-sm mt-1">Pay via M-Pesa & Submit Transaction Code</p>
                </div>
                <button onclick="closePaymentInstructions()" class="text-white hover:text-gray-200 transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
        </div>

        <div class="p-6 space-y-6">
            <!-- Amount Display -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-5 text-center">
                <p class="text-sm text-gray-600 mb-1">Amount to Pay</p>
                <p id="paymentAmount" class="text-4xl font-bold text-green-700">KSh 0</p>
                <p id="planName" class="text-sm text-gray-600 mt-2"></p>
            </div>

            <!-- Payment Instructions -->
            <div class="space-y-4">
                <h3 class="font-bold text-lg text-gray-800 flex items-center">
                    <span class="bg-blue-100 text-blue-900 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                    Pay via M-Pesa
                </h3>
                <div class="ml-11 space-y-3 bg-gray-50 p-4 rounded-lg">
                    <div class="flex items-start">
                        <i class="fas fa-mobile-alt text-green-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-800">Go to M-Pesa on your phone</p>
                            <p class="text-sm text-gray-600">Lipa Na M-Pesa → Paybill</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-building text-green-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-800">Business Number (Paybill)</p>
                            <p class="text-2xl font-bold text-blue-900">{{ manual_paybill_number }}</p>
                            <p class="text-xs text-gray-500">{{ manual_paybill_account_name }}</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-hashtag text-green-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-800">Account Number</p>
                            <p class="text-lg font-bold text-blue-900">{{ manual_paybill_account }}</p>
                            <p class="text-xs text-gray-500">Account Name: {{ manual_paybill_account_name }}</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-money-bill-wave text-green-600 mt-1 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-800">Enter Amount</p>
                            <p id="instructionAmount" class="text-lg font-bold text-blue-900">KSh 0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction Code Submission -->
            <div class="space-y-4">
                <h3 class="font-bold text-lg text-gray-800 flex items-center">
                    <span class="bg-blue-100 text-blue-900 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                    Submit Transaction Code
                </h3>
                <form id="transactionForm" class="ml-11 space-y-4">
                    {% csrf_token %}
                    <input type="hidden" id="selectedPlanType" name="plan_type">
                    <input type="hidden" id="selectedAmount" name="amount">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            M-Pesa Transaction Code <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="transactionCode" name="transaction_code" required
                               placeholder="e.g., QWE1234567"
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <p class="text-xs text-gray-500 mt-1">You'll receive this code via SMS after payment</p>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                            <div class="text-sm text-blue-800">
                                <p class="font-medium mb-1">What happens next?</p>
                                <ul class="list-disc list-inside space-y-1 text-xs">
                                    <li>Your membership number will be generated immediately</li>
                                    <li>Admin will verify your payment within 24 hours</li>
                                    <li>You'll get full access once verified</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button type="button" onclick="closePaymentInstructions()" 
                                class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-900 to-blue-700 text-white rounded-lg hover:from-blue-800 hover:to-blue-600 font-medium transition flex items-center justify-center">
                            <span>Submit</span>
                            <i class="fas fa-check ml-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFAQ(element) {
        const content = element.nextElementSibling;
        const icon = element.querySelector('i');
        
        // Toggle display
        if (content.classList.contains('hidden')) {
            content.classList.remove('hidden');
            icon.classList.add('transform', 'rotate-180');
        } else {
            content.classList.add('hidden');
            icon.classList.remove('transform', 'rotate-180');
        }
    }

    function selectTier(tier, amount) {
        // Show beautiful payment instructions popup
        showPaymentInstructions(tier, amount);
        return;
        
        // ORIGINAL PAYMENT POPUP CODE - UNCOMMENT WHEN PAYMENT IS READY:
        // const paymentForm = document.getElementById('paymentForm');
        // const totalAmount = document.getElementById('totalAmount');
        // const planTypeInput = document.getElementById('planType');
        // const amountInput = document.getElementById('amount');
        // 
        // // Set form values
        // planTypeInput.value = tier;
        // amountInput.value = amount;
        // totalAmount.textContent = `KSh ${amount}`;
        // 
        // // Show payment form
        // paymentForm.classList.remove('hidden');
        // 
        // // Add slide-in animation class if needed
        // paymentForm.classList.add('transform', 'translate-x-0');
        // 
        // // Default to M-Pesa payment method
        // document.getElementById('paymentMethod').value = 'mpesa';
        // togglePaymentMethod('mpesa');
        // 
        // // Scroll to top of payment form
        // paymentForm.scrollTop = 0;
    }

    // Toggle between student and graduate tiers
    document.getElementById('studentToggle').addEventListener('click', function() {
        this.classList.add('bg-blue-900', 'text-white');
        this.classList.remove('bg-gray-200', 'text-gray-700');
        document.getElementById('graduateToggle').classList.remove('bg-blue-900', 'text-white');
        document.getElementById('graduateToggle').classList.add('bg-gray-200', 'text-gray-700');
        document.getElementById('studentTiers').classList.remove('hidden');
        document.getElementById('graduateTiers').classList.add('hidden');
    });

    document.getElementById('graduateToggle').addEventListener('click', function() {
        this.classList.add('bg-blue-900', 'text-white');
        this.classList.remove('bg-gray-200', 'text-gray-700');
        document.getElementById('studentToggle').classList.remove('bg-blue-900', 'text-white');
        document.getElementById('studentToggle').classList.add('bg-gray-200', 'text-gray-700');
        document.getElementById('graduateTiers').classList.remove('hidden');
        document.getElementById('studentTiers').classList.add('hidden');
    });

    function toggleMembershipType(type) {
        const studentTiers = document.getElementById('studentTiers');
        const graduateTiers = document.getElementById('graduateTiers');
        const studentTab = document.getElementById('studentTab');
        const graduateTab = document.getElementById('graduateTab');

        if (type === 'student') {
            studentTiers.classList.remove('hidden');
            graduateTiers.classList.add('hidden');
            studentTab.classList.add('bg-blue-900', 'text-white');
            studentTab.classList.remove('text-blue-900', 'bg-white');
            graduateTab.classList.remove('bg-blue-900', 'text-white');
            graduateTab.classList.add('text-blue-900', 'bg-white');
        } else {
            studentTiers.classList.add('hidden');
            graduateTiers.classList.remove('hidden');
            graduateTab.classList.add('bg-blue-900', 'text-white');
            graduateTab.classList.remove('text-blue-900', 'bg-white');
            studentTab.classList.remove('bg-blue-900', 'text-white');
            studentTab.classList.add('text-blue-900', 'bg-white');
        }
    }

    function togglePaymentMethod(method) {
        const mpesaFields = document.getElementById('mpesaFields');
        const paypalFields = document.getElementById('paypalFields');
        const cardFields = document.getElementById('cardFields');
        const mpesaTab = document.getElementById('mpesaTab');
        const paypalTab = document.getElementById('paypalTab');
        const cardTab = document.getElementById('cardTab');
        const paymentMethodInput = document.getElementById('paymentMethod');

        paymentMethodInput.value = method;

        // Hide all fields first
        mpesaFields.classList.add('hidden');
        paypalFields.classList.add('hidden');
        cardFields.classList.add('hidden');
        
        // Reset all tabs
        mpesaTab.classList.remove('bg-blue-900', 'text-white', 'border-blue-500');
        paypalTab.classList.remove('bg-blue-900', 'text-white', 'border-blue-500');
        cardTab.classList.remove('bg-blue-900', 'text-white', 'border-blue-500');
        
        // Show the selected fields and activate the tab
        if (method === 'mpesa') {
            mpesaFields.classList.remove('hidden');
            mpesaTab.classList.add('border-blue-500');
        } else if (method === 'paypal') {
            paypalFields.classList.remove('hidden');
            paypalTab.classList.add('border-blue-500');
        } else if (method === 'card') {
            cardFields.classList.remove('hidden');
            cardTab.classList.add('border-blue-500');
        }
    }

    // Show payment instructions modal
    function showPaymentInstructions(tier, amount) {
        const modal = document.getElementById('paymentInstructionsModal');
        const paymentAmount = document.getElementById('paymentAmount');
        const instructionAmount = document.getElementById('instructionAmount');
        const planName = document.getElementById('planName');
        const selectedPlanType = document.getElementById('selectedPlanType');
        const selectedAmount = document.getElementById('selectedAmount');
        
        // Set values
        paymentAmount.textContent = `KSh ${amount}`;
        instructionAmount.textContent = `KSh ${amount}`;
        selectedPlanType.value = tier;
        selectedAmount.value = amount;
        
        // Set plan name
        const planNames = {
            'first_year': 'First Year Student',
            'other_students': 'Other Students',
            'graduate': 'Graduate/Professional'
        };
        planName.textContent = planNames[tier] || '';
        
        // Show modal
        modal.classList.remove('hidden');
    }
    
    // Close payment instructions modal
    function closePaymentInstructions() {
        const modal = document.getElementById('paymentInstructionsModal');
        modal.classList.add('hidden');
        document.getElementById('transactionCode').value = '';
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Handle transaction form submission
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitButton = this.querySelector('button[type="submit"]');
            
            // Show loading state
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
            
            // Submit to server
            fetch('/membership/submit-transaction/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    alert('✅ Transaction submitted successfully!\\n\\nYour membership number: ' + data.membership_number + '\\n\\nYour payment will be verified by admin within 24 hours. You can access the platform now!');
                    window.location.href = data.redirect_url || '/dashboard/';
                } else {
                    alert('❌ ' + (data.error || 'Failed to submit transaction. Please try again.'));
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>Submit</span><i class="fas fa-check ml-2"></i>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('❌ An error occurred. Please try again.');
                submitButton.disabled = false;
                submitButton.innerHTML = '<span>Submit</span><i class="fas fa-check ml-2"></i>';
            });
        });
    });
</script>
{% endblock %}
