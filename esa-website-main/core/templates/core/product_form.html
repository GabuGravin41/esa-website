{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<!-- Enhanced background image with better overlay gradient -->
<section class="relative bg-cover bg-center bg-fixed" style="background-image: url('https://images.unsplash.com/photo-1556740758-90de374c12ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');">
  <div class="bg-gradient-to-r from-blue-900/90 via-black/80 to-blue-900/90">
    <div class="container mx-auto px-4 py-24 text-center text-white">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-fade-in-down">{{ title }}</h1>
      <p class="max-w-2xl mx-auto mb-6 text-lg text-blue-100 animate-fade-in-up">
        Add a new product to the ESA-KU store
      </p>
    </div>
  </div>
</section>

<div class="container mx-auto px-4 py-12">
  {% if messages %}
    <div class="mb-8 animate-fade-in">
      {% for message in messages %}
        <div class="p-4 mb-3 {% if message.tags == 'success' %}bg-green-100 text-green-700 border-green-400{% elif message.tags == 'error' %}bg-red-100 text-red-700 border-red-400{% else %}bg-blue-100 text-blue-700 border-blue-400{% endif %} rounded-lg border-l-4 shadow-sm transition-all duration-300 hover:shadow-md">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <!-- Enhanced form container with better shadow and styling -->
  <div class="max-w-4xl mx-auto">
    <form method="POST" enctype="multipart/form-data" class="bg-white shadow-lg rounded-xl p-8 border border-gray-100 transition-all duration-300 hover:shadow-xl animate-fade-in">
      {% csrf_token %}
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="col-span-2">
          <label for="{{ form.name.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Product Name <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.name|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.name.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.name.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-2">
          <label for="{{ form.slug.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Slug <span class="text-gray-400">(optional)</span>
          </label>
          <div class="group relative">
            {{ form.slug|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          <p class="text-gray-500 text-xs mt-1 italic">Leave empty to generate automatically from name. Used in URLs.</p>
          {% if form.slug.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.slug.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-1">
          <label for="{{ form.price.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Price (KSh) <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.price|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.price.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.price.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-1">
          <label for="{{ form.stock.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Stock Quantity <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.stock|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.stock.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.stock.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-1">
          <label for="{{ form.category.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Category <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.category|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.category.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.category.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-1">
          <label for="{{ form.vendor.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Vendor <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.vendor|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.vendor.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.vendor.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-2">
          <label for="{{ form.description.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Description <span class="text-blue-600">*</span>
          </label>
          <div class="group relative">
            {{ form.description|safe }}
            <div class="absolute bottom-0 left-0 h-0.5 w-0 bg-blue-600 transition-all duration-300 group-hover:w-full"></div>
          </div>
          {% if form.description.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.description.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-2">
          <label for="{{ form.image.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            Product Image <i class="text-gray-400">(Recommended size: 800x600px)</i>
          </label>
          <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-400 transition-colors duration-300">
            <div class="space-y-1 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="flex justify-center text-sm text-gray-600">
                <label for="{{ form.image.id_for_label }}" class="relative cursor-pointer rounded-md font-medium text-blue-600 hover:text-blue-500">
                  {{ form.image|safe }}
                  <span>Upload an image</span>
                </label>
              </div>
              <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
            </div>
          </div>
          {% if form.image.errors %}
            <p class="text-red-500 text-xs mt-2">{{ form.image.errors.0 }}</p>
          {% endif %}
        </div>
        
        <div class="col-span-1">
          <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-300">
            {{ form.is_active|safe }}
            <label for="{{ form.is_active.id_for_label }}" class="ml-3 block text-sm font-medium text-gray-700">
              Active
            </label>
          </div>
          <p class="text-gray-500 text-xs mt-2 italic">Inactive products won't be shown in the store.</p>
        </div>
        
        <div class="col-span-1">
          <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-300">
            {{ form.featured|safe }}
            <label for="{{ form.featured.id_for_label }}" class="ml-3 block text-sm font-medium text-gray-700">
              Featured
            </label>
          </div>
          <p class="text-gray-500 text-xs mt-2 italic">Featured products are displayed prominently in the store.</p>
        </div>
      </div>
      
      <div class="mt-8 flex justify-end space-x-4">
        <a href="{% url 'store' %}" class="px-6 py-3 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 font-semibold transition-all duration-300 transform hover:-translate-y-1">
          Cancel
        </a>
        <button type="submit" class="px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-blue-800 text-white font-semibold transition-all duration-300 transform hover:-translate-y-1 hover:shadow-md">
          Save Product
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Auto-generate slug from title
  document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('{{ form.name.id_for_label }}');
    const slugInput = document.getElementById('{{ form.slug.id_for_label }}');
    
    // Apply custom styling to form inputs
    const formInputs = document.querySelectorAll('input[type="text"], input[type="number"], textarea, select');
    formInputs.forEach(input => {
      input.classList.add('w-full', 'p-3', 'border', 'border-gray-300', 'rounded-lg', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500', 'focus:border-transparent', 'transition-all', 'duration-300');
    });
    
    // Custom styling for select elements
    const selectElements = document.querySelectorAll('select');
    selectElements.forEach(select => {
      select.classList.add('bg-white', 'appearance-none');
    });
    
    // Custom styling for textarea
    const textareaElements = document.querySelectorAll('textarea');
    textareaElements.forEach(textarea => {
      textarea.classList.add('min-h-[120px]');
    });
    
    // Custom styling for checkboxes
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      checkbox.classList.add('w-5', 'h-5', 'text-blue-600', 'focus:ring-blue-500', 'rounded');
    });
    
    // Handle image input styling - hide the default file input
    const fileInput = document.querySelector('input[type="file"]');
    if (fileInput) {
      fileInput.classList.add('sr-only');
    }
    
    if (nameInput && slugInput) {
      nameInput.addEventListener('input', function() {
        // Only update slug if it's empty or was auto-generated (user hasn't manually edited it)
        if (!slugInput.value || slugInput._wasAutoGenerated) {
          const slug = nameInput.value
            .toLowerCase()
            .replace(/[^\w\s-]/g, '') // Remove special characters
            .replace(/\s+/g, '-')     // Replace spaces with hyphens
            .replace(/--+/g, '-');    // Replace multiple hyphens with single hyphen
          
          slugInput.value = slug;
          slugInput._wasAutoGenerated = true;
        }
      });
      
      // If user manually edits the slug, don't auto-update it anymore
      slugInput.addEventListener('input', function() {
        slugInput._wasAutoGenerated = false;
      });
    }
  });
</script>

<style>
  /* Custom animations */
  .animate-fade-in {
    animation: fadeIn 0.8s ease-in-out;
  }
  
  .animate-fade-in-down {
    animation: fadeInDown 0.8s ease-in-out;
  }
  
  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-in-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
{% endblock %}